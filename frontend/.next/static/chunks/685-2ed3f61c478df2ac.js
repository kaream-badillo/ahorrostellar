"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[685],{1466:(e,r,t)=>{t.d(r,{A:()=>j});var s=t(3365),a=t(1521),n=t(6296),c=t(105),o=t(9534),l=t.n(o),i=t(185),d=t(6182),u=t.n(d);async function m(){if(void 0===window.freighterApi)throw Error("Freighter no detectada. Verifica extensi\xf3n y permisos de sitio.");if(!(await u().isConnected()).isConnected)throw Error("Freighter no conectada");if(!(await u().setAllowed()).isAllowed)throw Error("Permiso denegado");let e=await u().getAddress();if(e.address)return e.address;let r=await u().requestAccess();if(r.error||!r.address)throw Error(r.error||"Sin address");return r.address}function h(){let[e,r]=(0,a.useState)(),[t,n]=(0,a.useState)(!1),[c,o]=(0,a.useState)(),l=async()=>{n(!0),o(void 0);try{let e=await m();r(e)}catch(r){let e=r instanceof Error?r.message:"Error desconocido";if(e.includes("Freighter no detectada"))return void window.open("https://freighter.app/","_blank");o(e)}finally{n(!1)}};return e?(0,s.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,s.jsxs)("div",{className:"px-3 py-1 bg-green-100 text-green-800 rounded-full text-sm font-medium",children:[e.slice(0,4),"…",e.slice(-4)]}),(0,s.jsx)("button",{onClick:()=>{r(void 0),o(void 0)},className:"text-xs text-red-600 hover:text-red-700",children:"Desconectar"})]}):(0,s.jsxs)("div",{className:"flex flex-col items-end space-y-2",children:[(0,s.jsx)("button",{className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-medium disabled:opacity-50",onClick:l,disabled:t,children:t?"Conectando...":"Connect Wallet"}),c&&(0,s.jsx)("p",{className:"text-xs text-red-600 text-right max-w-xs",children:c})]})}var x=t(5826);function f(e){let{showSearch:r=!0}=e,{state:t,clearNotifications:a}=(0,i.n)(),{user:o,notifications:d}=t;return(0,s.jsx)("header",{className:"bg-white/90 backdrop-blur-sm border-b border-stellar-100 sticky top-0 z-50",children:(0,s.jsx)("div",{className:"max-w-screen-xl mx-auto px-8 py-4",children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)(l(),{href:"/",className:"flex items-center space-x-3",children:[(0,s.jsx)(x.default,{src:"/favicon.png",alt:"Stellar Logo",width:32,height:32,className:"w-8 h-8"}),(0,s.jsx)("span",{className:"text-2xl font-bold gradient-text",children:"AhorroStellar"})]}),r&&(0,s.jsx)("div",{className:"flex-1 max-w-md mx-8",children:(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)(n.A,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"}),(0,s.jsx)("input",{type:"text",placeholder:"Search projects, users...",className:"w-full pl-10 pr-4 py-2 border border-stellar-100 rounded-lg focus:ring-2 focus:ring-stellarBlue focus:border-transparent"})]})}),(0,s.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,s.jsxs)("button",{className:"p-3 rounded-lg hover:bg-stellar-100 transition-colors relative",onClick:a,children:[(0,s.jsx)(c.A,{className:"w-6 h-6 text-gray-600"}),d>0&&(0,s.jsx)("span",{className:"absolute -top-1 -right-1 w-5 h-5 bg-red-500 rounded-full text-white text-xs flex items-center justify-center",children:d})]}),(0,s.jsx)(h,{})]})]})})})}var p=t(5e3),w=t(2717),g=t(6713),b=t(2393),y=t(1647),v=t(627);function N(){let e=(0,v.usePathname)(),{state:r,disconnectWallet:t}=(0,i.n)(),{user:a,wallet:n}=r,c=[{name:"Dashboard",href:"/dashboard",icon:p.A},{name:"Vote-Save",href:"/stake",icon:w.A},{name:"Reflector Debug",href:"/reflector-debug",icon:g.A}];return(0,s.jsx)("aside",{className:"w-72 bg-white/80 backdrop-blur-sm border-r border-gray-200 sticky top-16 h-screen overflow-y-auto hidden lg:block",children:(0,s.jsxs)("div",{className:"p-6",children:[(0,s.jsx)("nav",{className:"space-y-2 mb-8",children:c.map(r=>{let t=r.icon;return(0,s.jsxs)(l(),{href:r.href,className:"flex items-center space-x-3 px-4 py-3 rounded-lg transition-colors ".concat(e===r.href?"bg-blue-100 text-blue-700 font-medium shadow-sm":"hover:bg-blue-50 text-gray-600 hover:text-blue-700"),children:[(0,s.jsx)(t,{className:"w-5 h-5"}),(0,s.jsx)("span",{children:r.name})]},r.name)})}),(0,s.jsxs)("div",{className:"space-y-4 mb-8",children:[(0,s.jsx)("h3",{className:"text-sm font-semibold text-gray-700 mb-4",children:"Quick Summary"}),(0,s.jsxs)("div",{className:"bg-blue-50 rounded-lg p-4",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,s.jsx)("span",{className:"text-sm text-gray-600",children:"USDC Bloqueados"}),(0,s.jsxs)("span",{className:"text-sm font-semibold text-blue-600",children:[(null==a?void 0:a.activeStakes)||"0"," USDC"]})]}),(0,s.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,s.jsx)("span",{className:"text-sm text-gray-600",children:"Backed Projects"}),(0,s.jsx)("span",{className:"text-sm font-semibold text-green-600",children:r.myStakedProjects.length})]}),(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)("span",{className:"text-sm text-gray-600",children:"Reputation"}),(0,s.jsx)("span",{className:"text-sm font-semibold text-purple-600",children:(null==a?void 0:a.reputationLevel)||"Bronze"})]})]})]}),(0,s.jsxs)("div",{className:"space-y-3 mb-8",children:[(0,s.jsx)("h3",{className:"text-sm font-semibold text-gray-700 mb-4",children:"Security"}),(0,s.jsxs)("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:[(0,s.jsxs)("div",{className:"flex items-center space-x-2 mb-2",children:[(0,s.jsx)(b.A,{className:"w-4 h-4 text-green-600"}),(0,s.jsx)("span",{className:"text-sm font-medium text-green-700",children:"Your savings are safe"})]}),(0,s.jsxs)("div",{className:"space-y-1 text-xs text-green-600",children:[(0,s.jsx)("p",{children:"• USDC se bloquea por 7 d\xedas"}),(0,s.jsx)("p",{children:"• Se recupera autom\xe1ticamente"}),(0,s.jsx)("p",{children:"• Sin riesgo de p\xe9rdida"})]})]})]}),(0,s.jsx)("div",{className:"border-t border-gray-200 pt-6",children:(0,s.jsx)("div",{className:"space-y-2",children:(0,s.jsxs)("button",{onClick:()=>{t()},className:"flex items-center space-x-3 px-4 py-3 text-red-600 hover:text-red-700 hover:bg-red-50 rounded-lg transition-colors w-full",children:[(0,s.jsx)(y.A,{className:"w-5 h-5"}),(0,s.jsx)("span",{children:"Sign Out"})]})})})]})})}function j(e){let{children:r,showSidebar:t=!0,showSearch:a=!0}=e;return(0,s.jsxs)("div",{className:"min-h-screen bg-gradient-to-br from-light to-white",children:[(0,s.jsx)(f,{showSearch:a}),(0,s.jsxs)("div",{className:"flex",children:[t&&(0,s.jsx)(N,{}),(0,s.jsx)("main",{className:"flex-1 p-4 lg:p-8",children:(0,s.jsx)("div",{className:"max-w-6xl mx-auto px-4 sm:px-6 lg:px-8",children:r})})]})]})}},1695:(e,r,t)=>{t.d(r,{A:()=>o});var s=t(3365),a=t(1521),n=t(4130);let c=a.forwardRef((e,r)=>{let{className:t,variant:a="default",children:c,...o}=e;return(0,s.jsx)("div",{className:(0,n.cn)("card-stellar rounded-xl shadow-lg border border-stellar-100/50",{default:"bg-white/80 backdrop-blur-sm",glass:"bg-white/10 backdrop-blur-md border-white/20",gradient:"bg-gradient-to-br from-white/90 to-white/70"}[a],t),ref:r,...o,children:c})});c.displayName="Card";let o=c},4130:(e,r,t)=>{t.d(r,{cn:()=>n});var s=t(4584),a=t(2292);function n(){for(var e=arguments.length,r=Array(e),t=0;t<e;t++)r[t]=arguments[t];return(0,a.QP)((0,s.$)(r))}},8934:(e,r,t)=>{t.d(r,{n7:()=>E,FN:()=>N,to:()=>j,yA:()=>v,priceUSDCinUSD:()=>g,priceXLMinUSD:()=>y,Mj:()=>C,usdPerCLP:()=>b});var s=t(3547),a=t(4089),n=t(4089),c=t(4746).hp;let o=n.env.NEXT_PUBLIC_SOROBAN_RPC_PRIMARY||"https://soroban-testnet.stellar.org",l=n.env.NEXT_PUBLIC_STELLAR_NETWORK_PASSPHRASE||s.Networks.TESTNET,i=n.env.NEXT_PUBLIC_REFLECTOR_CONTRACT_ID_USDC||"CAVLP5DH2GJPZMVO7IJY4CVOD5MWEFTJFVPD2YY2FQXOQHRGHK4D6HLP",d=n.env.NEXT_PUBLIC_REFLECTOR_CONTRACT_ID_FX||"CCSSOHTBL3LEWUCBBEB5NJFC2OKFRC74OWEIJIZLRJBGAAU4VMU5NV4W",u=n.env.NEXT_PUBLIC_REFLECTOR_CONTRACT_ID_CEX||"CCYOZJCOPG34LLQQ7N24YXBM7LL62R7ONMZ3G6WZAAYPB5OYKOMJRN63",m=new s.rpc.Server(o,{allowHttp:!0}),h=function(e){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:14;return Number(e)/10**r};var x=function(e){return e[e.Stellar=1]="Stellar",e[e.Other=2]="Other",e}(x||{});function f(e){let r=null;switch(e.type){case 1:{let t=e.code.split(":");if(2===t.length){let[e,a]=t;if(!e||!a)throw Error("Asset code and issuer must be defined");if(!s.StrKey.isValidEd25519PublicKey(a))throw Error("Asset issuer must be a valid ed25519 public key");r=new s.Asset(e,a)}else if("XLM"===e.code)r=s.Asset.native();else{if(!s.StrKey.isValidContract(e.code))throw Error("Asset code ".concat(e.code," is invalid contract ID"));return new s.Address(e.code).toScVal()}break}case 2:let t;if(e.code.length>32)throw Error("Asset code must be 32 characters or less");return t=e.code,s.xdr.ScVal.scvSymbol(t);default:throw Error("Asset type ".concat(e.type," is not supported"))}if(r){let e=new s.xdr.HashIdPreimageContractId({networkId:(0,s.hash)(c.from(l)),contractIdPreimage:s.xdr.ContractIdPreimage.contractIdPreimageFromAsset(r.toXDRObject())}),t=s.xdr.HashIdPreimage.envelopeTypeContractId(e),a=s.StrKey.encodeContract((0,s.hash)(t.toXDR()));return new s.Address(a).toScVal()}throw Error("Failed to build asset ScVal")}async function p(e,r,t){try{var n,c;let o=function(){let e=a.env.NEXT_PUBLIC_READONLY_PUBLIC_KEY||"";return e&&"<TU_PUBLIC_KEY_G...>"!==e?s.StrKey.isValidEd25519PublicKey(e)?(console.log("Using real Reflector account:",e.slice(0,6)+"..."+e.slice(-6)),e):(console.warn("Invalid public key format, using demo key"),"GDEMO123456789012345678901234567890123456789012345678901234567890"):(console.warn("NEXT_PUBLIC_READONLY_PUBLIC_KEY not configured, using demo key"),"GDEMO123456789012345678901234567890123456789012345678901234567890")}();if(o.startsWith("GDEMO")){if(console.warn("\uD83D\uDD27 DEMO MODE: Using fallback prices (configure .env.local for real Reflector)"),"lastprice"===r){if(e===i)return 1;if(e===u)return .12}if("x_last_price"===r){if(e===d)return 1e3;if(e===u)return .12}if("decimals"===r)return 14;if("last_timestamp"===r)return Math.floor(Date.now()/1e3);return 1}console.log("\uD83D\uDE80 REAL REFLECTOR: Fetching live prices from Oracle");let x=await m.getAccount(o),f=new s.Contract(e),p=new s.TransactionBuilder(x,{fee:s.BASE_FEE,networkPassphrase:l}).addOperation(f.call(r,...t)).setTimeout(30).build(),w=await m.simulateTransaction(p);if(s.rpc.Api.isSimulationError(w))throw Error("Simulation error: ".concat(w.error));let g=null!=(c=null==(n=w.result)?void 0:n.retval)?c:w.result;if(!g)throw Error("No retval from simulation");let b=(0,s.scValToBigInt)(g);return h(b)}catch(t){if(console.error("Error in simulateRead(".concat(e,", ").concat(r,"):"),t),t instanceof Error&&(t.message.includes("Account not found")||t.message.includes("invalid checksum"))){if(console.warn("Account error detected, falling back to demo prices"),"lastprice"===r){if(e===i)return 1;if(e===u)return .12}if("x_last_price"===r){if(e===d)return 1e3;if(e===u)return .12}if("decimals"===r)return 14;if("last_timestamp"===r)return Math.floor(Date.now()/1e3);return 1}throw t}}async function w(e){try{let r=await p(e,"decimals",[]);return Math.floor(r)}catch(r){return console.warn("Failed to get decimals for ".concat(e,", using default ").concat(14)),14}}async function g(){try{return await p(i,"lastprice",[f({type:2,code:"USDC"})])}catch(e){return console.warn("Reflector Oracle unavailable, using demo price for USDC:",e),1}}async function b(){try{return await p(d,"x_last_price",[f({type:2,code:"USD"}),f({type:2,code:"CLP"})])}catch(e){return console.warn("Reflector Oracle unavailable, using demo price for USD/CLP:",e),1e3}}async function y(){try{return await p(u,"x_last_price",[f({type:1,code:"XLM"}),f({type:2,code:"USD"})])}catch(e){return console.warn("Reflector Oracle unavailable, using demo price for XLM/USD:",e),.12}}async function v(){try{let e=await b();return 1/e}catch(e){return console.error("Failed to get CLP/USD price:",e),.001}}async function N(e,r){let t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;try{return await p(e,"twap",[f(r),s.xdr.ScVal.scvU32(t)])}catch(e){throw console.error("Failed to get TWAP for ".concat(r.code,":"),e),e}}async function j(e,r,t){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2;try{return await p(e,"x_twap",[f(r),f(t),s.xdr.ScVal.scvU32(a)])}catch(e){throw console.error("Failed to get X-TWAP for ".concat(r.code,"/").concat(t.code,":"),e),e}}async function E(e){try{let r=await p(e,"last_timestamp",[]);return Math.floor(r)}catch(r){throw console.error("Failed to get last timestamp for ".concat(e,":"),r),r}}async function C(){let e={usdcUsd:{price:0,error:null,timestamp:Date.now()},usdClp:{price:0,error:null,timestamp:Date.now()},xlmUsd:{price:0,error:null,timestamp:Date.now()},clpUsd:{price:0,error:null,timestamp:Date.now()},decimals:{usdc:0,fx:0,cex:0,errors:[]},lastTimestamps:{usdc:0,fx:0,cex:0,errors:[]},twaps:{usdc:0,xlm:0,errors:[]}};try{e.usdcUsd.price=await g()}catch(r){e.usdcUsd.error=r instanceof Error?r.message:"Unknown error"}try{e.usdClp.price=await b()}catch(r){e.usdClp.error=r instanceof Error?r.message:"Unknown error"}try{e.xlmUsd.price=await y()}catch(r){e.xlmUsd.error=r instanceof Error?r.message:"Unknown error"}try{e.clpUsd.price=await v()}catch(r){e.clpUsd.error=r instanceof Error?r.message:"Unknown error"}try{e.decimals.usdc=await w(i),e.decimals.fx=await w(d),e.decimals.cex=await w(u)}catch(r){e.decimals.errors.push(r instanceof Error?r.message:"Unknown error")}try{e.lastTimestamps.usdc=await E(i),e.lastTimestamps.fx=await E(d),e.lastTimestamps.cex=await E(u)}catch(r){e.lastTimestamps.errors.push(r instanceof Error?r.message:"Unknown error")}try{e.twaps.usdc=await N(i,{type:2,code:"USDC"},2),e.twaps.xlm=await N(u,{type:1,code:"XLM"},2)}catch(r){e.twaps.errors.push(r instanceof Error?r.message:"Unknown error")}return e}}}]);